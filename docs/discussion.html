<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Discussion | Application of a Principaled Bayesian Workflow to Multilevel Modeling</title>
  <meta name="description" content="7 Discussion | Application of a Principaled Bayesian Workflow to Multilevel Modeling" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Discussion | Application of a Principaled Bayesian Workflow to Multilevel Modeling" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="adkudson/thesis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Discussion | Application of a Principaled Bayesian Workflow to Multilevel Modeling" />
  
  
  

<meta name="author" content="Alexander D. Knudson" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="results.html"/>
<link rel="next" href="conclusion.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#ch010-classical-methods"><i class="fa fa-check"></i><b>1.1</b> Everything can be Blamed on Fisher</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#ch010-new-methods"><i class="fa fa-check"></i><b>1.2</b> Proposal of New Methods</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#ch010-organization"><i class="fa fa-check"></i><b>1.3</b> Organization</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="motivating-data.html"><a href="motivating-data.html"><i class="fa fa-check"></i><b>2</b> What is a Model without Data</a><ul>
<li class="chapter" data-level="2.1" data-path="motivating-data.html"><a href="motivating-data.html#psycho-experiments"><i class="fa fa-check"></i><b>2.1</b> Psychometric Experiments</a></li>
<li class="chapter" data-level="2.2" data-path="motivating-data.html"><a href="motivating-data.html#toj-task"><i class="fa fa-check"></i><b>2.2</b> Temporal Order Judgment Data</a></li>
<li class="chapter" data-level="2.3" data-path="motivating-data.html"><a href="motivating-data.html#data-visualizations-and-quirks"><i class="fa fa-check"></i><b>2.3</b> Data Visualizations and Quirks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>3</b> Principled Bayesian Workflow</a><ul>
<li class="chapter" data-level="3.1" data-path="workflow.html"><a href="workflow.html#iter1"><i class="fa fa-check"></i><b>3.1</b> Iteration 1 (journey of a thousand miles)</a></li>
<li class="chapter" data-level="3.2" data-path="workflow.html"><a href="workflow.html#iter2"><i class="fa fa-check"></i><b>3.2</b> Iteration 2 (electric boogaloo)</a></li>
<li class="chapter" data-level="3.3" data-path="workflow.html"><a href="workflow.html#iter3"><i class="fa fa-check"></i><b>3.3</b> Iteration 3 (the one for me)</a></li>
<li class="chapter" data-level="3.4" data-path="workflow.html"><a href="workflow.html#iter4"><i class="fa fa-check"></i><b>3.4</b> Iteration 4 (what’s one more)</a></li>
<li class="chapter" data-level="3.5" data-path="workflow.html"><a href="workflow.html#celebrate"><i class="fa fa-check"></i><b>3.5</b> Celebrate</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="model-checking.html"><a href="model-checking.html"><i class="fa fa-check"></i><b>4</b> Model Fitting/Checking</a><ul>
<li class="chapter" data-level="4.1" data-path="model-checking.html"><a href="model-checking.html#fitting-using-hmc"><i class="fa fa-check"></i><b>4.1</b> Fitting using HMC</a><ul>
<li class="chapter" data-level="4.1.1" data-path="model-checking.html"><a href="model-checking.html#diagnostic-tools"><i class="fa fa-check"></i><b>4.1.1</b> Diagnostic Tools</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="model-checking.html"><a href="model-checking.html#prior-predictive-checks"><i class="fa fa-check"></i><b>4.2</b> Prior Predictive Checks</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="predictive-inferences.html"><a href="predictive-inferences.html"><i class="fa fa-check"></i><b>5</b> Predictive Inference</a><ul>
<li class="chapter" data-level="5.1" data-path="predictive-inferences.html"><a href="predictive-inferences.html#model-comparison-via-predictive-performance"><i class="fa fa-check"></i><b>5.1</b> Model Comparison via Predictive Performance</a><ul>
<li class="chapter" data-level="5.1.1" data-path="predictive-inferences.html"><a href="predictive-inferences.html#loocv-and-importance-sampling"><i class="fa fa-check"></i><b>5.1.1</b> LOOCV and Importance Sampling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>6</b> Psychometric Results</a><ul>
<li class="chapter" data-level="6.1" data-path="results.html"><a href="results.html#affect-of-adaptation-across-age-groups"><i class="fa fa-check"></i><b>6.1</b> Affect of Adaptation across Age Groups</a><ul>
<li class="chapter" data-level="6.1.1" data-path="results.html"><a href="results.html#on-perceptual-synchrony"><i class="fa fa-check"></i><b>6.1.1</b> On Perceptual Synchrony</a></li>
<li class="chapter" data-level="6.1.2" data-path="results.html"><a href="results.html#on-temporal-sensitivity"><i class="fa fa-check"></i><b>6.1.2</b> On Temporal Sensitivity</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="results.html"><a href="results.html#lapse-rate-across-age-groups"><i class="fa fa-check"></i><b>6.2</b> Lapse Rate across Age Groups</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>7</b> Discussion</a><ul>
<li class="chapter" data-level="7.1" data-path="discussion.html"><a href="discussion.html#model-selection-is-not-always-the-goal"><i class="fa fa-check"></i><b>7.1</b> Model selection is not always the goal</a></li>
<li class="chapter" data-level="7.2" data-path="discussion.html"><a href="discussion.html#data-cleaning-and-reproducibility"><i class="fa fa-check"></i><b>7.2</b> Data Cleaning and Reproducibility</a></li>
<li class="chapter" data-level="7.3" data-path="discussion.html"><a href="discussion.html#developing-a-model"><i class="fa fa-check"></i><b>7.3</b> Developing a model</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>8</b> Conclusion</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="supplementary-code.html"><a href="supplementary-code.html"><i class="fa fa-check"></i><b>A</b> Supplementary Code</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Application of a Principaled Bayesian Workflow to Multilevel Modeling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="discussion" class="section level1">
<h1><span class="header-section-number">7</span> Discussion</h1>
<div id="model-selection-is-not-always-the-goal" class="section level2">
<h2><span class="header-section-number">7.1</span> Model selection is not always the goal</h2>
<p>Building a model motivated by a set of principles and domain expertise should be the preferred way of performing an analysis. The next important principle is model comparison, especially in terms of predictive inference. One model also doesn’t always work for everything. In the course of building a model that is just complex enough to answer questions about age and temporal recalibration, I mentioned that intermediate models could be used to answer questions about average effects at different levels. For purely predictive inference, there is also the possibility of Bayesian model averaging (BMA) and other ensemble methods.</p>
</div>
<div id="data-cleaning-and-reproducibility" class="section level2">
<h2><span class="header-section-number">7.2</span> Data Cleaning and Reproducibility</h2>
<p>Data doesn’t always come in a nice tidy<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a> format, and I had the pleasure of turning the raw experimental data into a clean data set that is ready for modeling. Sometimes the process is quick and straight forward, but other times, like with this psychometric data, it takes more effort and clever techniques. There is academic value in describing the steps I took up front to reduce the headache later.</p>
<p>To begin, there is a strong push in recent years for reproducible data science. Scientific methods and results should be able to be replicated by other researchers, and part of that includes being able to replicate the process that takes the raw data and produces the tidy data that is ready for analysis. Tidy data is described by <span class="citation">Wickham and others (<a href="#ref-wickham2014tidy" role="doc-biblioref">2014</a>)</span> and can be summed up by three principles</p>
<ol style="list-style-type: decimal">
<li>Each variable forms a column</li>
<li>Each observation forms a row</li>
<li>Each type of observational unit forms a table</li>
</ol>
<p>One problem I have come across and have been guilty of in the past is having data in a spread sheet, modifying it, and then having no way of recovering the original data. Spread sheets are a convenient way to organize, transform, and lightly analyze date, but problems can quickly arise unless there is a good backup/snapshot system in place. Data is immutable<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a>, or at least that is the mindset that researchers must adopt in order to have truly reproducible workflows. The raw data that is collected or produced by a measurement device should never be modified without first being copied, even if for trivial reasons such as correcting a spelling mistake<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>.</p>
<p>To begin the data cleaning journey, I’ll introduce the directory system that I had been given to work with. Each task is separated into its own folder, and within each folder is a subdirectory of age groups.</p>
<pre><code>RecalibrationData
├── ParticipantAgeSex.xlsx
├── Audiovisual
│   ├── MiddleAge
│   ├── Older
│   └── Young
├── Duration
│   ├── MiddleAge
│   ├── Older
│   └── Young
├── Sensorimotor
│   ├── MiddleAge
│   ├── Older
│   └── Young
└── Visual
    ├── MiddleAge
    ├── Older
    └── Young</code></pre>
<p>Within each age group subdirectory are the subdirectories for each subject named by their initials which then contain the experimental data in Matlab files.</p>
<pre><code>├── MiddleAge
│   ├── BT
│   │   ├── BTadapt1__MAT.mat
│   │   ├── ...
│   ├── ...
├── Older
│   ├── BB
│   │   ├── BBadapt1__MAT.mat
│   │   ├── ...
│   ├── ...
└── Young
    ├── AC
    │   ├── ACadapt1__MAT.mat
    │   ├── ...
    ├── ...</code></pre>
<p>At this point, the data appears manageable, there is information contained in the directory structure such as task, age group, and initials, and file name contains information about the experimental block. There is also an excel file that I was later given that contains more subject information like age and sex, though that information is not used in the model. The columns of the Matlab file depends on the task, but generally contains an SOA value and a response, but no column or row name information - that was provided by the researcher who collected the data.</p>
<p>The next thing I did was to create a table of metadata - information extracted from the directory structure and file names combined with the the subject data and the file path. Regular expressions can be used to extract patterns from a string. With a list of all Matlab files within the <code>RecalibrationData</code> folder, I tried to extract the task, age group, initials, and block using the expression</p>
<pre><code>&quot;^(\\w+)/(\\w+)/(\\w+)/[A-Z]{2,3}_*[A-Z]*(adapt[0-9]|baseline[0-9]*).*&quot;</code></pre>
<p>Breaking it apart, the <code>^(\\w+)/</code> matches any word characters at the start and before the next slash. Since the directory structure is <code>Task/AgeGroup/Subject/file.mat</code>, the regular expression should match three words between slashes. The file name generally follows the pattern of <code>Initials__block#__MAT.mat</code>, so <code>[A-Z]{2,3}_*[A-Z]*</code> should match the initials, and <code>(adapt[0-9]|baseline[0-9]*)</code> should match the block (baseline or adapt). This method works for <span class="math inline">\(536\)</span> of the <span class="math inline">\(580\)</span> individual records. For the ones it failed, it was generally do to misspellings or irregular capitalizing of “baseline” and “adapt”.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="discussion.html#cb32-1"></a><span class="kw">table</span>(feat_typ[,<span class="dv">4</span>])</span>
<span id="cb32-2"><a href="discussion.html#cb32-2"></a><span class="co">#&gt; </span></span>
<span id="cb32-3"><a href="discussion.html#cb32-3"></a><span class="co">#&gt;   AC   AG   BB   BC   BT   CB   CC   CE   CJ   CM   DB   DC   DD   DE  DTF   DW </span></span>
<span id="cb32-4"><a href="discussion.html#cb32-4"></a><span class="co">#&gt;   13   12   13   13   13   13   10   12   13    4   13   13    7   12   12   13 </span></span>
<span id="cb32-5"><a href="discussion.html#cb32-5"></a><span class="co">#&gt;   EM   ET   GB   GT   HG   IV   JM JM_F   JS   JW   KC   KK   LP   MC   MS   MW </span></span>
<span id="cb32-6"><a href="discussion.html#cb32-6"></a><span class="co">#&gt;   13   13   13   13   13    4   12   13   13   13   13   11    7   13   13   26 </span></span>
<span id="cb32-7"><a href="discussion.html#cb32-7"></a><span class="co">#&gt;   NP   PB   SB   SJ  SJF   TS   TW   VM   WL   WW   YG </span></span>
<span id="cb32-8"><a href="discussion.html#cb32-8"></a><span class="co">#&gt;   12   13   12   26   13   13   13   13   13   12    7</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="discussion.html#cb33-1"></a><span class="kw">table</span>(feat_atyp[,<span class="dv">4</span>])</span>
<span id="cb33-2"><a href="discussion.html#cb33-2"></a><span class="co">#&gt; </span></span>
<span id="cb33-3"><a href="discussion.html#cb33-3"></a><span class="co">#&gt;  AG  CC  CE  CM  DD DTF  IV  JM  JS  KK  NP  SB  WW  YG </span></span>
<span id="cb33-4"><a href="discussion.html#cb33-4"></a><span class="co">#&gt;   1   3   1   9   6   1   9   1   2   2   1   1   1   6</span></span></code></pre></div>
<p>Since there is only a handful of irregular block names, they can be dealt with a separate regular expression that properly extracts the block information. Other challenges in cleaning the data include the handling of subjects with the same initials. This becomes a problem because filtering by a subject’s initials is not guaranteed to return a unique subject. Furthermore there are two middle age subjects with the same initials of “JM”, so one was also identified with their sex “JM_F”. The solution is to create a unique identifier (labeled as SID) that is a combination of age group, sex, and initials. For an experiment identifier (labeled as RID), the task and block were prepended to the SID. Each of these IDs uniquely identify the subjects and their experimental records making it easier to filter and search.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="discussion.html#cb34-1"></a><span class="kw">glimpse</span>(features)</span>
<span id="cb34-2"><a href="discussion.html#cb34-2"></a><span class="co">#&gt; Rows: 580</span></span>
<span id="cb34-3"><a href="discussion.html#cb34-3"></a><span class="co">#&gt; Columns: 8</span></span>
<span id="cb34-4"><a href="discussion.html#cb34-4"></a><span class="co">#&gt; $ rid       &lt;fct&gt; av-post1-M-f-CC, av-post1-M-f-DB, av-post1-M-f-HG, av-post1…</span></span>
<span id="cb34-5"><a href="discussion.html#cb34-5"></a><span class="co">#&gt; $ sid       &lt;fct&gt; M-f-CC, M-f-DB, M-f-HG, M-f-JM, M-f-MS, M-f-SJF, M-f-TS, M-…</span></span>
<span id="cb34-6"><a href="discussion.html#cb34-6"></a><span class="co">#&gt; $ path      &lt;chr&gt; &quot;Audiovisual/MiddleAge/CC/CCadapt1__MAT.mat&quot;, &quot;Audiovisual/…</span></span>
<span id="cb34-7"><a href="discussion.html#cb34-7"></a><span class="co">#&gt; $ task      &lt;chr&gt; &quot;audiovisual&quot;, &quot;audiovisual&quot;, &quot;audiovisual&quot;, &quot;audiovisual&quot;,…</span></span>
<span id="cb34-8"><a href="discussion.html#cb34-8"></a><span class="co">#&gt; $ trial     &lt;fct&gt; post1, post1, post1, post1, post1, post1, post1, post1, pos…</span></span>
<span id="cb34-9"><a href="discussion.html#cb34-9"></a><span class="co">#&gt; $ age_group &lt;fct&gt; middle_age, middle_age, middle_age, middle_age, middle_age,…</span></span>
<span id="cb34-10"><a href="discussion.html#cb34-10"></a><span class="co">#&gt; $ age       &lt;dbl&gt; 39, 44, 41, 48, 49, 43, 47, 49, 49, 44, 43, 44, 48, 48, 50,…</span></span>
<span id="cb34-11"><a href="discussion.html#cb34-11"></a><span class="co">#&gt; $ sex       &lt;fct&gt; F, F, F, F, F, F, F, F, F, M, M, M, M, M, M, F, F, F, F, F,…</span></span></code></pre></div>
<p>Then with the table of clean metadata, the task is simply to loop through each row, read the Matlab file given by <code>path</code>, add the unique ID as a column, and then join the experimental data with the metadata to create a data set that is ready for model fitting and data exploration. The full code used to generate the clean data is not yet available online, but can be shared with the committee.</p>
<p>The benefit of writing a script to generate the data is that others can look over my code and verify that it is doing what I intended for it to do, and I can go back to any step within the process to make changes if the need comes up. Another tool that contributed to the reproducibility is the version control management software, Git. With Git I can take a snapshot of the changes I make, and revert if necessary. This thesis is also hosted on Github, and the entire history of development can be viewed there.</p>
</div>
<div id="developing-a-model" class="section level2">
<h2><span class="header-section-number">7.3</span> Developing a model</h2>
<p><a href="workflow.html#workflow">Chapter 3</a> details the deeper considerations that went into building a model, but doesn’t tell the full story of struggles and setbacks I faced. I find that I learn more from others when they share what didn’t work along with the final path that did work. There is knowledge to be gained in failed experiments, because then there is one more way to not do something, just like a failing outcome reduces the variance of the Beta distribution.</p>
<p>I knew that I wanted to apply Bayesian modeling techniques to the data, because it was something knew that I was learning. I tried using a classical GLM to first get a baseline understanding of the data, but the fact that some estimates for certain subjects failed due to complete separation reinforced my enthusiasm to employ non-classical techniques. My first Bayesian model was derived from <span class="citation">Lee and Wagenmakers (<a href="#ref-lee2014bayesian" role="doc-biblioref">2014</a>)</span> which used nested loops to iterate over subjects and SOA values. I felt that the data was stored in a complicated way and made it difficult to comprehend and extend.</p>
<p>Next I moved on to using <code>arm::bayesglm</code> to remove convergence issues, but was met with other limitations such as linear parameterization and lack of hierarchical modeling. The book Statistical Rethinking <span class="citation">(McElreath <a href="#ref-mcelreath2020statistical" role="doc-biblioref">2020</a>)</span> was my first introduction to Bayesian multilevel modeling. His <code>rethinking</code> package accompanies the book, and offers a compact yet expressive syntax for models that get translated into a Stan model. A model with age group and block can be written using <code>rethinking::ulam</code> as</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="discussion.html#cb35-1"></a>rethinking<span class="op">::</span><span class="kw">ulam</span>(<span class="kw">alist</span>(</span>
<span id="cb35-2"><a href="discussion.html#cb35-2"></a>  k <span class="op">~</span><span class="st"> </span><span class="kw">binomial_logit</span>(n, p),</span>
<span id="cb35-3"><a href="discussion.html#cb35-3"></a>  <span class="dt">p =</span> <span class="kw">exp</span>(b <span class="op">+</span><span class="st"> </span>bG[G] <span class="op">+</span><span class="st"> </span>bT[trt]) <span class="op">*</span><span class="st"> </span>(x <span class="op">-</span><span class="st"> </span>(a <span class="op">+</span><span class="st"> </span>aG[G] <span class="op">+</span><span class="st"> </span>aT[trt])),</span>
<span id="cb35-4"><a href="discussion.html#cb35-4"></a>  a <span class="op">~</span><span class="st"> </span><span class="kw">normal</span>(<span class="dv">0</span>, <span class="fl">0.06</span>),</span>
<span id="cb35-5"><a href="discussion.html#cb35-5"></a>  aG[G] <span class="op">~</span><span class="st"> </span><span class="kw">normal</span>(<span class="dv">0</span>, sd_aG),</span>
<span id="cb35-6"><a href="discussion.html#cb35-6"></a>  aT[trt] <span class="op">~</span><span class="st"> </span><span class="kw">normal</span>(<span class="dv">0</span>, sd_aT),</span>
<span id="cb35-7"><a href="discussion.html#cb35-7"></a>  b <span class="op">~</span><span class="st"> </span><span class="kw">normal</span>(<span class="dv">3</span>, <span class="dv">1</span>),</span>
<span id="cb35-8"><a href="discussion.html#cb35-8"></a>  bG[G] <span class="op">~</span><span class="st"> </span><span class="kw">normal</span>(<span class="dv">0</span>, sd_bG),</span>
<span id="cb35-9"><a href="discussion.html#cb35-9"></a>  bT[trt] <span class="op">~</span><span class="st"> </span><span class="kw">normal</span>(<span class="dv">0</span>, sd_bT),</span>
<span id="cb35-10"><a href="discussion.html#cb35-10"></a>  <span class="kw">c</span>(sd_aG, sd_aT, sd_bG, sd_bT) <span class="op">~</span><span class="st"> </span><span class="kw">half_cauchy</span>(<span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb35-11"><a href="discussion.html#cb35-11"></a>), <span class="dt">data =</span> df, <span class="dt">chains =</span> <span class="dv">4</span>, <span class="dt">cores =</span> <span class="dv">4</span>, <span class="dt">log_lik =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>During my time learning about multilevel models, I tried writing my own package that generates a Stan program based on R formula syntax. At the time I didn’t fully understand the concepts of no-pooling, complete pooling, and partial pooling, and my package was plagued by the same lack of flexibility that <code>rstanarm</code> and <code>brms</code> have. In fact I learned that <code>brms</code> and <code>rstanarm</code> already did what I was trying to do after I had already started making my library, but it was a fun learning and programming experience. The fossilized remains of my attempt can be viewed on github.</p>
<p>I also tried using <code>lme4</code>, <code>rstanarm</code>, and <code>brms</code>, and learned more about the concepts of fixed and random effects. It was around this time that I noticed that parameterization can have a significant affect on the efficiency of a model and the inferential power of the estimated parameters. When fitting a classical model, there is little difference in estimating <code>a + bx</code> vs. <code>d(x - c)</code> since the latter can just be expanded as <code>-cd + dx</code> which is essentially the same as the first parameterization, but there is a practical difference in the interpretation of the parameters. The second parameterization implies that there is a dependence among the parameters that can be factored out. In the context of psychometric functions, there is a stronger connection between PSS and <code>c</code> and the JND and <code>d</code>. This parameterization made it easier to specify priors and also increased the model efficiency. Since only <code>rethinking</code> and <code>Stan</code> allow for arbitrary parameterization, I left the others behind.</p>
<p>I finally arrived at a model that worked well, but learned that using a binary indicator variable for the treatment comes with the assumption of higher uncertainty for one of the conditions. The linear model that I arrived at is displayed in equation <a href="discussion.html#eq:badlinearmodel">(7.1)</a>.</p>
<p><span class="math display" id="eq:badlinearmodel">\[\begin{equation}
  \theta = \exp(\beta + \beta_G +(\beta_T + \beta_{TG})\times trt) \left[x - (\alpha + \alpha_G + (\alpha_T + \alpha_{TG})\times trt)\right]
  \tag{7.1}
\end{equation}\]</span></p>
<p>Using an indicator variable in this fashion also introduced an interaction effect into the model that I almost did not account for after I switched to using a factor variable. Interaction effects between factors is handled by creating a new factor that is essentially the cross-product of other factor variables. E.g. for factor variables <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span></p>
<p><span class="math display">\[
x = \begin{bmatrix}
a \\
b \\
c
\end{bmatrix}, y =  \begin{bmatrix}
i \\
j
\end{bmatrix}\Longrightarrow x\times y = 
\begin{bmatrix}
ai &amp; aj \\
bi &amp; bj \\
ci &amp; cj
\end{bmatrix}
\]</span></p>
<p>The final round of reparameterization came in the form of adopting non-centered parameterization for more efficient models. To us, <span class="math inline">\(Z \sim N(0, 1^2);\quad X = 3 + 2Z\)</span> is the same as <span class="math inline">\(X \sim N(3, 2^2)\)</span>, but to a computer the process of sampling from <span class="math inline">\(X\)</span> can be more difficult than sampling from <span class="math inline">\(Z\)</span> (discussed in <a href="model-checking.html#model-checking">chapter 4</a>).</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-lee2014bayesian">
<p>Lee, Michael D, and Eric-Jan Wagenmakers. 2014. <em>Bayesian Cognitive Modeling: A Practical Course</em>. Cambridge university press.</p>
</div>
<div id="ref-mcelreath2020statistical">
<p>McElreath, Richard. 2020. <em>Statistical Rethinking: A Bayesian Course with Examples in R and Stan</em>. CRC press.</p>
</div>
<div id="ref-wickham2014tidy">
<p>Wickham, Hadley, and others. 2014. “Tidy Data.” <em>Journal of Statistical Software</em> 59 (10): 1–23.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="10">
<li id="fn10"><p>Tidy data is described by Hadley Wickham<a href="discussion.html#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>Mutability in computer science is the property of a data structure where its contents can be modified in place. Immutability means that the object cannot be modified without first making a copy.<a href="discussion.html#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>If a change is made to the raw data, it should be carefully documented and reversible<a href="discussion.html#fnref12" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="results.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/adknudson/thesis/blob/master/070-discussion.Rmd",
"text": null
},
"download": ["adknudson-thesis.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 3,
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
